{% extends "frontend/layout.twig" %}

{% set start     = schedule.localStart %}
{% set scheduled = schedule.localStart %}
{% set columns   = schedule.columns    %}
{% set numCols   = columns|length      %}
{% set fluid     = numCols > 4         %}

{% block fulltitle %}{{ schedule.name }} &ndash; {{ event.name }}{% endblock %}

{% block navheader %}
<div class="navbar-header">
	<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#h-collapse-nav">
		<span class="sr-only">Toggle navigation</span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
	</button>
	<a href="/{{ event.slug }}" class="navbar-brand">{{ event.name }}</a>
</div>
{% endblock %}

{% block navigation %}
<ul class="nav navbar-nav">
	{% for sched in event.schedules %}
	<li><a href="/{{ event.slug }}/{{ sched.slug }}"><i class="fa fa-calendar"></i> {{ sched.name }}</a></li>
	{% endfor %}
</ul>

<ul class="nav navbar-nav navbar-right">
	{% if event.website %}<li><a href="{{ event.website }}" target="_blank" title="{{ event.website }}"><i class="fa fa-globe"></i></a></li>{% endif %}
	{% if event.twitch %}<li><a href="http://twitch.tv/{{ event.twitch }}" target="_blank" title="{{ event.twitch }}"><i class="fa fa-twitch"></i></a></li>{% endif %}
	{% if event.twitter %}<li><a href="http://twitter.com/{{ event.twitter }}" target="_blank" title="@{{ event.twitter }}"><i class="fa fa-twitter"></i></a></li>{% endif %}
</ul>
{% endblock %}

{% block content %}
<div class="row">
	<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
		<h2>{{ schedule.name }}</h2>
	</div>
</div>

<div class="row">
	<div class="col-lg-12 text-center">
		<h4>Starts on <strong><time datetime="{{ start.format('Y-m-d\\TH:i:sP') }}" class="h-fancy">{{ start.format('l, F d, Y') }}</time></strong></h4>
	</div>
</div>

<div class="row">
	<div class="col-lg-12">
		<p class="text-center text-muted" id="localized-note">
			<small>All dates and times are given in {{ schedule.timezone }} timezone (UTC{{ start.format('P') }}).</small>
			<small class="nope">All dates and times are given in your local timezone.</small>
		</p>
	</div>
</div>

<table class="table h-schedule h-l{{ schedule.getMaxItemWidth(columns) }}" data-columns="{{ numCols }}">
	<thead>
		<tr>{% spaceless %}
			<th class="h-s">Scheduled</th>
			<th class="h-0">{{ columns[0].name }}</th>
			<th class="h-l">Estimated</th>
			{% for idx,column in columns.slice(1) %}
			<th class="h-{{ idx }}">{{ column.name }}</th>
			{% endfor %}
		{% endspaceless %}</tr>
	</thead>

	{% for idx,item in schedule.items %}
	<tbody class="{{ idx % 2 ? 'h-odd' : 'h-even' }} h-i-l{{ item.getWidth(columns) }}">
		<tr class="h-primary">
			{% set extra = item.extra %}
			<td class="h-s"><time datetime="{{ scheduled.format('Y-m-d\\TH:i:sP') }}">{{ scheduled.format('H:i:s') }}</time></td>
			<td class="h-0">{{ extra[columns[0].id]|default('') }}</td>
			<td class="h-l"><time datetime="{{ item.isoDuration }}">{{ item.length.format('H:i:s') }}</time></td>
			{% for idx,column in columns.slice(1) %}
			<td class="h-{{ idx }}">{{ extra[column.id]|default('') }}</td>
			{% endfor %}
		</tr>

		{% set old       = scheduled.format('d') %}
		{% set scheduled = scheduled.add(item.dateInterval) %}

		{% if idx > 0 and old != scheduled.format('d') %}
		<tr class="h-new-day">
			<td colspan="{{ numCols + 2 }}">{{ scheduled.format('l, F d, Y') }}</td>
		</tr>
		{% endif %}
	</tbody>
	{% endfor %}
</table>

{% if numCols > 1 %}
<script type="text/html" id="controls">
<td class="h-co">
	<button class="btn btn-link btn-xs" rel="more"><i class="fa fa-angle-double-down"></i> more</button>
	<button class="btn btn-link btn-xs" rel="less"><i class="fa fa-angle-double-up"></i> less</button>
	<button class="btn btn-link btn-xs" disabled><i class="fa fa-angle-double-down"></i> more</button>
</td>
</script>

<script type="text/html" id="expanded_tpl">
<tr class="h-secondary">
	<td colspan="{{ numCols + 2 }}">
		<dl class="dl-horizontal">
			<dt class="h-e-l">Estimated:</dt>
			<dd class="h-e-l">&nbsp;</dd>
			{% for idx,column in columns.slice(1) %}
			<dt class="h-e-{{ idx }}">{{ column.name }}:</dt>
			<dd class="h-e-{{ idx }}">&nbsp;</dd>
			{% endfor %}
		</dl>
	</td>
</tr>
</script>
{% endif %}
{% endblock %}
